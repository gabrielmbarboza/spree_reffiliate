<% content_for :page_title do %>
  <%#= link_to "#{Spree.t(:editing_affiliate)}", edit_admin_affiliate_url(@affiliate) %>
  <%= link_to Spree.t(:affiliates), edit_admin_affiliate_url(@affiliate) %> /
  <%= Spree.t(:edit_affiliate) %>
<% end %>

<% content_for :page_actions do %>
  <%= button_link_to Spree.t(:back_to_affiliates_list), spree.admin_affiliates_path, { class: "btn-success", icon: 'glyphicon glyphicon-arrow-left', id: 'admin_back_affiliate' } %>
<% end %>

<div data-hook="admin_affiliate_edit_form_header">
  <%= render :partial => 'spree/shared/error_messages', :locals => { :target => @affiliate } %>
</div>

<div data-hook="admin_affiliate_edit_form">
  <%= form_for [:admin, @affiliate], as: :affiliate, url: admin_affiliate_url(@affiliate), method: :put do |f| %>
    <%= render :partial => 'form', :locals => { :f => f } %>

    <div data-hook="admin_affiliate_edit_form_button">
      <%= render :partial => 'spree/admin/shared/edit_resource_links', :locals => { :collection_url => admin_affiliates_url } %>
    </div>
  <% end %>
</div>
<br />
<div class="panel panel-default" data-hook="admin_affiliate_edit_stats">
  <div class="panel-heading">
    <h1 class="panel-title"><%= Spree.t(:statistics) %></h1>
  </div>

  <table class="table">
    <tbody>
      <tr>
        <td>Affiliate hyperlink</td>
        <td><%= text_field_tag nil, affiliate_url(@affiliate.path), onclick: 'this.select();', class: 'form-control title'%></td>
      </tr>
      <tr>
        <td>Partial Status</td>
        <% if @affiliate.partial.blank? or !affiliate_partial_exists?(@affiliate.partial) %>
          <td style="color: red">Not found</td>
        <% elsif affiliate_partial_exists?(@affiliate.partial) %>
          <td style="color: green">Found</td>
        <% end %>
      </tr>
      <tr>
        <td>Referred users count</td>
        <td><%= @affiliate.referred_count %></td>
      </tr>
      <tr>
        <td>Referred orders count</td>
        <td><%= @affiliate.referred_orders.count %></td>
      </tr>
      <tr>
        <td>Orders referred</td>
        <td>
          <%= "No referred orders" if @affiliate.referred_orders.count == 0 %>
          <ol style="margin-left: 20px;">
            <% @affiliate.referred_orders.each do |user| %>
              <li><%= link_to user.email, edit_admin_user_url(user) %></li>
            <% end %>
          </ol>
        </td>
      <tr>
      <tr>
        <td>Users referred</td>
        <td>
          <%= "No referred users" if @affiliate.referred_count == 0 %>
          <ol style="margin-left: 20px;">
            <% @affiliate.referred_users.each do |user| %>
              <li><%= link_to user.email, edit_admin_user_url(user) %></li>
            <% end %>
          </ol>
        </td>
      <tr>
    </tbody>
  </table>
</div>
